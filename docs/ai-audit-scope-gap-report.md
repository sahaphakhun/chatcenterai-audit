# üîé AI Order Audit ‚Äî Scope & Gap Report

> **Date:** 2025-12-19  
> **Reference spec:** `docs/ai-audit-system.md`  

‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠ ‚Äú‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™‚Äù ‡∏ß‡πà‡∏≤‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏ú‡∏°‡∏ó‡∏≥ **‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á** ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà **‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥/‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö** (‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°)

---

## 1) ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ó‡∏≥ ‚Äú‡πÄ‡∏Å‡∏¥‡∏ô‡∏™‡πÇ‡∏Ñ‡∏õ‚Äù (‡πÅ‡∏•‡∏∞‡∏ñ‡∏≠‡∏î‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß)

‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ ‡πÅ‡∏ï‡πà‡∏ñ‡∏π‡∏Å‡∏ñ‡∏≠‡∏î‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ ‚Äú‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‚Äù:

1) **‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å settings/UI ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô**
   - ‡∏ï‡∏±‡∏î‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: `delivery=admin_only`, `askStrategy`, `cooldownSeconds`, `maxAskTurns`, `requiredFields.*`
   - ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà: `orderAudit.enabled`, `orderAudit.waitForMainAiSeconds`

2) **Dedupe/session fields ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏á**
   - ‡∏ï‡∏±‡∏î‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: `askTurns`, `lastSentKind`, `lastSentMessage`, `draftSignature` ‡πÅ‡∏•‡∏∞ logic ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á

3) **Heuristic ‡∏Å‡∏±‡∏ô false positive ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å prompt**
   - ‡∏ï‡∏±‡∏î‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏ä‡πà‡∏ô purchase keywords / inquiry-only post-filter)

4) **‡πÇ‡∏Ñ‡∏£‡∏á field ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ (responseStyle/template/model)**
   - ‡∏ï‡∏±‡∏î‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏≤‡∏Å config/documentation ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏±‡∏ö‡∏™‡∏ô

5) **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°: audit message ‡πÄ‡∏Ç‡πâ‡∏≤ order buffer**
   - ‡∏ï‡∏±‡∏î‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: `deliverOrderAuditMessage()` ‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `appendOrderExtractionMessage()` ‡∏≠‡∏µ‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ

---

## 2) ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà ‚Äú‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö/‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‚Äù (Gap)

1) **Template editor ‡∏ï‡πà‡∏≠‡πÄ‡∏û‡∏à**
   - ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏≤‡∏°/‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏õ‡πá‡∏ô template ‡πÅ‡∏ö‡∏ö fixed ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î (‡∏¢‡∏±‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏û‡∏à‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å UI)

2) **‡πÑ‡∏°‡πà‡∏°‡∏µ automated tests**
   - Repo ‡πÑ‡∏°‡πà‡∏°‡∏µ test suite ‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° Jest test ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö normalize/validate/build message

3) **‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤/‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö audit session (admin dashboard)**
   - ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ UI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏π `order_audit_sessions` (‡πÄ‡∏ä‡πà‡∏ô pending, missing fields, last push) ‡∏ô‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏î‡∏π‡πÉ‡∏ô DB/log

4) **‡πÄ‡∏°‡∏∑‡πà‡∏≠ OpenAI ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡πÑ‡∏°‡πà‡∏°‡∏µ fallback parser**
   - ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏Å OpenAI ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (error/timeout) ‡∏à‡∏∞‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ `hasDraft=false` ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏£‡∏ö‡∏Å‡∏ß‡∏ô)

---

## 3) ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠ (‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞ ‚Äú‡∏ï‡∏±‡∏î‚Äù ‡∏≠‡∏∞‡πÑ‡∏£‡∏≠‡∏≠‡∏Å)

‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‚Äú‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏™‡πÇ‡∏Ñ‡∏õ‚Äù ‡∏ñ‡∏π‡∏Å‡∏ñ‡∏≠‡∏î‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠ 1)
