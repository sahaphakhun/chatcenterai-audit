# üßæ AI Order Audit System (Sidecar)

> **Last updated:** 2025-12-19  
> **Status:** Spec (single doc)  
> **Default delivery (MVP):** `push_customer` (‡∏™‡πà‡∏á‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ö‡∏ö push ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)  

‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ ‚ÄúOrder Audit‚Äù ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà **‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå** ‡πÅ‡∏•‡∏∞ **‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î/‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á** ‡πÅ‡∏ö‡∏ö‡πÅ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å AI ‡∏´‡∏•‡∏±‡∏Å (AI ‡∏´‡∏•‡∏±‡∏Å‡∏¢‡∏±‡∏á‡∏ï‡∏≠‡∏ö‡πÅ‡∏ä‡∏ó‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥)

## 1) ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢

- ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö ‚Äúorder draft‚Äù ‡∏à‡∏≤‡∏Å‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤ (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
- ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö ‚Üí ‡∏™‡πà‡∏á ‚Äú‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‚Äù
- ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö/‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚Üí ‡∏™‡πà‡∏á ‚Äú‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‚Äù
- ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ‡∏£‡∏≤‡∏¢‡πÄ‡∏û‡∏à/‡∏£‡∏≤‡∏¢‡∏ö‡∏≠‡∏ó ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏≤‡∏¢‡πÄ‡∏û‡∏à

## 2) Non-goals (‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏ó‡∏≥)

- ‡πÑ‡∏°‡πà‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà AI ‡∏´‡∏•‡∏±‡∏Å ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏õ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á AI ‡∏´‡∏•‡∏±‡∏Å
- **‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏î ‡πÜ** ‡∏ñ‡πâ‡∏≤ ‚Äú‡∏¢‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡πÑ‡∏°‡πà‡∏û‡∏ö order draft/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‚Äù (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)
- ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏ó‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏° (Order Extraction ‡πÄ‡∏î‡∏¥‡∏°‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏°‡∏±‡∏ô‡πÑ‡∏î‡πâ)

## 3) ‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏´‡∏•‡∏±‡∏Å (Requirements)

### 3.1 ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)

‡∏£‡∏∞‡∏ö‡∏ö Audit ‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° **‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠**:
- ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö **order draft** (‡∏ô‡∏¥‡∏¢‡∏≤‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠ 7.0) ‡πÅ‡∏•‡∏∞
- `items.length >= 1`

‡∏ñ‡πâ‡∏≤ `items` ‡∏ß‡πà‡∏≤‡∏á ‚Üí **‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°** (‡πÅ‡∏ï‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï session ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)

### 3.1.1 ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç ‚Äú‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‚Äù ‡∏ï‡∏≠‡∏ô AI ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)

‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö 2 ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå:

- **‡πÄ‡∏Ñ‡∏™‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏´‡∏•‡∏±‡∏Å**: Audit ‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏™‡πà‡∏á‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô)
- **‡πÄ‡∏Ñ‡∏™‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏´‡∏•‡∏±‡∏Å**: Audit ‡∏ï‡πâ‡∏≠‡∏á ‚Äú‡∏£‡∏≠‡πÉ‡∏´‡πâ AI ‡∏´‡∏•‡∏±‡∏Å‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô‚Äù ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ **‡∏ä‡πà‡∏ß‡∏á‡∏£‡∏≠‡πÅ‡∏ö‡∏ö debounce** ‡∏à‡∏≤‡∏Å setting (‡πÄ‡∏ä‡πà‡∏ô 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)

‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á:
- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‚Äú‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‚Äù
- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‚Äú‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‚Äù

> ‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏≠‡∏¢‡∏π‡πà (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ debounce) ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡∏°‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° ‚Üí ‡πÉ‡∏´‡πâ ‚Äú‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÄ‡∏î‡∏¥‡∏°‚Äù ‡πÅ‡∏•‡∏∞ ‚Äú‡∏ï‡∏£‡∏ß‡∏à‡πÉ‡∏´‡∏°‡πà‚Äù ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏ó‡∏ô

### 3.2 ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å Audit

‚Äú‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö Audit‚Äù ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 2 ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô:
1) **‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå** (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö)  
2) **‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î/‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á** (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö)

### 3.3 ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥

‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢:
- ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö (`customerName`)
- ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà/‡∏´‡∏°‡∏π‡πà/‡∏ã‡∏≠‡∏¢/‡∏ñ‡∏ô‡∏ô (`shippingAddress`)
- ‡∏ï‡∏≥‡∏ö‡∏•/‡πÅ‡∏Ç‡∏ß‡∏á (`addressSubDistrict`)
- ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠/‡πÄ‡∏Ç‡∏ï (`addressDistrict`)
- ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå (`addressPostalCode`) ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç **5 ‡∏´‡∏•‡∏±‡∏Å**
- ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ (`phone`) ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÑ‡∏ó‡∏¢ **10 ‡∏´‡∏•‡∏±‡∏Å** ‡∏´‡∏•‡∏±‡∏á normalize

> ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (`addressProvince`) ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏µ ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î requirement ‡πÑ‡∏î‡πâ‡∏£‡∏≤‡∏¢‡πÄ‡∏û‡∏à

### 3.4 ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ AI ‡∏´‡∏•‡∏±‡∏Å‡∏õ‡∏¥‡∏î / ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏≠‡∏ö‡πÄ‡∏≠‡∏á

- ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö / ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å Facebook inbox)  
‡∏ñ‡πâ‡∏≤‡πÄ‡∏û‡∏à‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏õ‡∏¥‡∏î Audit ‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏±‡∏á ‚Äú‡∏™‡∏£‡∏∏‡∏õ/‡∏ï‡∏£‡∏ß‡∏à/‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‚Äù ‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å `chat_history` ‡πÄ‡∏™‡∏°‡∏≠

## 4) ‡∏à‡∏∏‡∏î‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (Integration Points)

‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ:

- `chat_history` (MongoDB): ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
  - ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ‡∏ú‡πà‡∏≤‡∏ô `saveChatHistory()` (`source: "user"`)
  - ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö: `POST /admin/chat/send` (`source: "admin_chat"`)
  - ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å Facebook inbox: webhook `messagingEvent.message.is_echo` (`source: "admin_page"`)
- `appendOrderExtractionMessage(chatDoc)`:
  - ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£ insert ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å append ‡πÄ‡∏Ç‡πâ‡∏≤ `order_extraction_buffers` (event source ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö worker)
- `follow_up_page_settings`:
  - ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô per-page settings store ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏û‡∏¥‡πà‡∏° `orderAudit` ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÑ‡∏î‡πâ)

### 4.1 ‡∏ô‡∏¥‡∏¢‡∏≤‡∏° ‚ÄúAI ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‚Äù (‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤)

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Audit ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏à‡∏∞ ‚Äú‡∏™‡πà‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‚Äù ‡∏´‡∏£‡∏∑‡∏≠ ‚Äú‡∏£‡∏≠‚Äù ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ AI ‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏ä‡πà‡∏ô:

- **‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏≠‡∏ó/‡πÄ‡∏û‡∏à**
  - LINE: `line_bots.status === "active"` (‡∏´‡∏£‡∏∑‡∏≠ flag ‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤)
  - Facebook: `facebook_bots.status === "active"`
- **‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ AI ‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ** (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏õ‡∏¥‡∏î‡∏£‡∏≤‡∏¢ user)
  - `active_user_status.aiEnabled === true`
- **‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏ß‡∏°** (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ global switch)
  - `settings.aiEnabled === true` (‡∏´‡∏£‡∏∑‡∏≠ key ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö)

‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡πá‡∏ô boolean ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß: `mainAiEnabled` ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πâ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠ 3.1.1

## 5) ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏° (Architecture)

‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: **Sidecar/Worker** (‡πÅ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å AI ‡∏´‡∏•‡∏±‡∏Å)

```
‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô)
        ‚Üì
‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å chat_history
        ‚Üì
appendOrderExtractionMessage() ‚Üí order_extraction_buffers
        ‚Üì
OrderAuditRunner (async/worker)
  - ‡πÇ‡∏´‡∏•‡∏î per-page config (orderAudit)
  - ‡πÇ‡∏´‡∏•‡∏î session (‡∏Å‡∏±‡∏ô‡∏ñ‡∏≤‡∏°‡∏ã‡πâ‡∏≥/‡∏Å‡∏±‡∏ô spam)
  - ‡∏™‡∏Å‡∏±‡∏î order draft (items+‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ó‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ)
  - ‡∏ñ‡πâ‡∏≤ items ‡∏ß‡πà‡∏≤‡∏á ‚Üí STOP (‡πÑ‡∏°‡πà‡∏™‡πà‡∏á)
  - validate ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ
  - ‡∏ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏î ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
  - ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏£‡∏ö ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
  - ‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö push (default) ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•
```

## 6) Flow ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)

### 6.1 Trigger

Audit runner ‚Äú‡∏Ñ‡∏ß‡∏£‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‚Äù ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤ `chat_history` ‡πÅ‡∏•‡πâ‡∏ß (‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏°‡∏≤‡∏à‡∏≤‡∏Å):
- ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
- ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
- ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å Facebook inbox

### 6.2 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÉ‡∏ô runner

1) ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì `pageKey = ${platform}:${botId || "default"}`
2) ‡πÇ‡∏´‡∏•‡∏î config: `follow_up_page_settings.orderAudit`
   - ‡∏ñ‡πâ‡∏≤ `enabled !== true` ‚Üí ‡∏à‡∏ö
3) ‡πÇ‡∏´‡∏•‡∏î session ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏π‡πà‡∏ô‡∏µ‡πâ (`pageKey + userId`) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏ñ‡∏≤‡∏°‡∏ã‡πâ‡∏≥
4) ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î N ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å `chat_history` (‡∏£‡∏ß‡∏°‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢)
5) **ignore** ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á audit ‡πÄ‡∏≠‡∏á (`source/metadata === "order_audit"`) ‡πÄ‡∏™‡∏°‡∏≠
6) ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å ‚ÄúOrder Draft Extractor‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ `{ hasDraft, draft }`
7) **‡∏Å‡∏é‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç**: ‡∏ñ‡πâ‡∏≤ `hasDraft !== true` ‡∏´‡∏£‡∏∑‡∏≠ `draft.items` ‡πÑ‡∏°‡πà‡∏°‡∏µ/‡∏ß‡πà‡∏≤‡∏á ‚Üí **STOP (‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°)**
8) Validate draft ‡∏ï‡∏≤‡∏° requirement ‡∏ó‡∏µ‡πà fix ‡πÑ‡∏ß‡πâ (‡∏ä‡∏∑‡πà‡∏≠/‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà/‡∏ï‡∏≥‡∏ö‡∏•/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠/‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå/‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£)
9) ‡∏ñ‡πâ‡∏≤ ‚Äú‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö/‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‚Äù ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (‡∏ñ‡∏≤‡∏°‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
10) ‡∏ñ‡πâ‡∏≤ ‚Äú‡∏Ñ‡∏£‡∏ö‚Äù ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå + ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
11) ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à ‚Äú‡∏™‡πà‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‚Äù ‡∏´‡∏£‡∏∑‡∏≠ ‚Äú‡∏£‡∏≠‚Äù ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ AI ‡∏´‡∏•‡∏±‡∏Å
   - ‡∏ñ‡πâ‡∏≤ AI ‡∏´‡∏•‡∏±‡∏Å **‡∏õ‡∏¥‡∏î** ‚Üí ‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
   - ‡∏ñ‡πâ‡∏≤ AI ‡∏´‡∏•‡∏±‡∏Å **‡πÄ‡∏õ‡∏¥‡∏î** ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô ‚Äúpending‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏≠ `waitForMainAiSeconds` (‡πÄ‡∏õ‡πá‡∏ô debounce window) ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏≠‡∏¢‡∏™‡πà‡∏á
12) ‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ (`role: "user"`) ‚Üí ‡πÉ‡∏´‡πâ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏á‡∏≤‡∏ô pending ‡πÄ‡∏î‡∏¥‡∏° ‚Äú‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠ 4) ‡πÉ‡∏´‡∏°‡πà (‡∏ï‡∏£‡∏ß‡∏à‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
13) ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πà‡∏á (pending due) ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏ã‡πâ‡∏≥‡∏ß‡πà‡∏≤ ‚Äú‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á pending‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏™‡πà‡∏á
14) ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï session: `missingFields`, `lastAskedFields`, `pending`, `lastPushedAt`, `lastProcessedMessageId`

### 6.3 Scheduler (‡∏™‡πà‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏ö‡πÄ‡∏ß‡∏•‡∏≤)

‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏µ ‚Äú‡∏£‡∏≠ 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‚Äù ‡πÅ‡∏•‡∏∞ ‚Äú‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‚Äù ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏µ worker 2 ‡∏™‡πà‡∏ß‡∏ô:

1) **Runner**: ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà ‚Üí ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡∏∞ ‚Äú‡∏ï‡∏±‡πâ‡∏á pending‚Äù (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠)
2) **Due Sender**: ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô interval (‡πÄ‡∏ä‡πà‡∏ô‡∏ó‡∏∏‡∏Å 5‚Äì10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) ‚Üí ‡∏´‡∏≤ session ‡∏ó‡∏µ‡πà `pending.dueAt <= now` ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á

‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç):
- ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤ ‚Äú‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‚Äù ‡∏´‡∏•‡∏±‡∏á `pending.triggeredAt` (‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏á `pending.triggerMessageId`)
- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‚Üí ‡∏•‡∏ö/‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å pending ‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ runner ‡∏à‡∏≤‡∏Å event ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏´‡∏°‡πà

## 7) Order Draft Extractor (‡∏™‡∏Å‡∏±‡∏î‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏ö‡∏ö‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö)

### 7.0 ‡∏ô‡∏¥‡∏¢‡∏≤‡∏° ‚ÄúOrder Draft‚Äù (‡∏•‡∏î false positive)

‡∏ô‡∏¥‡∏¢‡∏≤‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ: **Order draft = ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á ‚Äú‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‚Äù (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏Ñ‡πà‡∏ñ‡∏≤‡∏°/‡∏Ç‡∏≠‡∏î‡∏π/‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏≤‡∏Ñ‡∏≤) ‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏Å‡∏±‡∏î `items` ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£**

‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ extractor ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏ñ‡∏≤‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏ñ‡∏≤‡∏°‡∏™‡∏ï‡πä‡∏≠‡∏Å/‡∏ñ‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‚Äù ‚Üí `hasDraft: false` (‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏≥ `draft.items = []`)
- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠/‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏¥‡∏£‡πå‡∏°‡πÄ‡∏≠‡∏≤/‡πÉ‡∏´‡πâ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á/‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‚Äù ‚Üí `hasDraft: true` (‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ `draft.items.length >= 1`)

#### ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì ‚Äú‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‚Äù (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)

‡πÉ‡∏´‡πâ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô draft ‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ `items` ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ:

- ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠/‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏¥‡∏£‡πå‡∏°: `‡∏™‡∏±‡πà‡∏á`, `‡πÄ‡∏≠‡∏≤`, `‡∏£‡∏±‡∏ö`, `‡∏ã‡∏∑‡πâ‡∏≠`, `‡πÄ‡∏≠‡∏≤‡πÄ‡∏•‡∏¢`, `‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå`, `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô`, `‡∏õ‡∏¥‡∏î‡∏¢‡∏≠‡∏î`
- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô/‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: `x1`, `1 ‡∏ä‡∏¥‡πâ‡∏ô`, `‡πÄ‡∏≠‡∏≤ 2`, `2 ‡∏≠‡∏±‡∏ô`, ‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏µ/‡πÑ‡∏ã‡∏ã‡πå/‡πÅ‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á/‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô: `‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á`, `COD`, `‡πÇ‡∏≠‡∏ô`, `‡∏™‡πà‡∏á`, `‡∏à‡∏±‡∏î‡∏™‡πà‡∏á`, `‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á`
- ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á): ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£, ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå, ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (‡πÄ‡∏ä‡πà‡∏ô `‡∏°.`, `‡∏ã.`, `‡∏ñ.`, `‡∏ï.`, `‡∏≠.`, `‡∏à.`)

#### ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì ‚Äú‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‚Äù (‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡πâ `hasDraft=false`)

‡∏ñ‡πâ‡∏≤‡∏°‡∏µ `items` ‡πÅ‡∏ï‡πà‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô ‡πÉ‡∏´‡πâ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ **‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô order draft** ‡πÄ‡∏ä‡πà‡∏ô:

- `‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà`, `‡∏°‡∏µ‡πÑ‡∏´‡∏°`, `‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏´‡∏°`, `‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ‡πÑ‡∏´‡∏°`, `‡∏°‡∏µ‡∏™‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á`, `‡∏Ç‡∏≠‡∏î‡∏π‡∏£‡∏π‡∏õ`, `‡∏™‡∏ô‡πÉ‡∏à‡∏Ñ‡πà‡∏∞` (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏¥‡∏£‡πå‡∏°)

#### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (‡∏Ñ‡∏ß‡∏£/‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏ô‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô draft)

- ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà draft (‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á): `‡∏ß‡∏¥‡∏Å‡∏ú‡∏°‡∏™‡∏≤‡∏¢‡∏ù‡∏≠ ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà‡∏Ñ‡∏∞`
- ‡πÄ‡∏õ‡πá‡∏ô draft (‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ): `‡πÄ‡∏≠‡∏≤‡∏ß‡∏¥‡∏Å‡∏ú‡∏°‡∏™‡∏≤‡∏¢‡∏ù‡∏≠ ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• 1 ‡∏ä‡∏¥‡πâ‡∏ô‡∏Ñ‡πà‡∏∞`
- ‡πÄ‡∏õ‡πá‡∏ô draft (‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ): `‡∏£‡∏±‡∏ö 1 ‡∏ä‡∏¥‡πâ‡∏ô ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á ‡∏™‡πà‡∏á 80120`

### 7.1 Output schema (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)

```json
{
  "hasDraft": true,
  "draft": {
    "items": [
      { "product": "‡∏ß‡∏¥‡∏Å‡∏ú‡∏°‡∏™‡∏≤‡∏¢‡∏ù‡∏≠ ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•", "quantity": 1, "price": 199 }
    ],
    "totalAmount": 199,
    "shippingCost": 0,
    "paymentMethod": "‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á",

    "customerName": "‡∏û‡∏µ‡πà‡∏≠‡∏µ‡πä‡∏î ‡∏à‡∏¥‡∏ï‡∏£‡∏≤‡∏†‡∏£‡∏ì‡πå ‡∏ö‡∏≠‡∏ô‡∏™‡∏µ",
    "shippingAddress": "62/2 ‡∏°.7",
    "addressSubDistrict": "‡∏ó‡∏∏‡πà‡∏á‡∏õ‡∏£‡∏±‡∏á",
    "addressDistrict": "‡∏™‡∏¥‡∏ä‡∏•",
    "addressProvince": "‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä",
    "addressPostalCode": "80120",
    "phone": "0993079111"
  },
  "confidence": 0.0,
  "reason": "..."
}
```

### 7.2 ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

- Extractor ‡∏ï‡πâ‡∏≠‡∏á ‚Äú‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏™‡∏Å‡∏±‡∏î items ‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‚Äù ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‚Äù (‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏™‡∏ï‡πä‡∏≠‡∏Å/‡∏Ç‡∏≠‡∏î‡∏π) ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô `hasDraft: false` (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ `items: []` ‡∏î‡πâ‡∏ß‡∏¢) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞
- **‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö** ‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏£‡∏ö‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô prompt ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á order extraction
- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à/‡πÑ‡∏°‡πà‡∏û‡∏ö items ‚Üí ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô `items: []` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ runner STOP ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏™‡πà‡∏á

## 8) Validation & Normalization

### 8.1 ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÑ‡∏ó‡∏¢ 10 ‡∏´‡∏•‡∏±‡∏Å (normalize)

- ‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á/‡∏Ç‡∏µ‡∏î/‡∏ß‡∏á‡πÄ‡∏•‡πá‡∏ö/‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö:
  - `+66xxxxxxxxx` ‚Üí ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô `0xxxxxxxxx`
  - `66xxxxxxxxx` ‚Üí ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô `0xxxxxxxxx`
- ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ regex: `^0\\d{9}$`

### 8.2 ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå

- ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 5 ‡∏´‡∏•‡∏±‡∏Å: `^\\d{5}$`

## 9) ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Loop / ‡∏™‡πà‡∏á‡∏ã‡πâ‡∏≥

### 9.1 Tag ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á Audit

‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà Audit ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á:
- `source: "order_audit"`
- ‡πÅ‡∏•‡∏∞/‡∏´‡∏£‡∏∑‡∏≠ `metadata: "order_audit"`

‡πÅ‡∏•‡∏∞ runner ‡∏ï‡πâ‡∏≠‡∏á ignore ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏™‡∏°‡∏≠

### 9.2 Facebook echo (`is_echo`)

Facebook ‡∏à‡∏∞‡∏™‡πà‡∏á echo ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏à‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏≠‡∏á:
- ‡∏ï‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏î‡πâ‡∏ß‡∏¢ `sendFacebookMessage()` ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà `metadata: "order_audit"`
- webhook ‡∏ù‡∏±‡πà‡∏á `is_echo` ‡∏ï‡πâ‡∏≠‡∏á ‚Äú‡∏Ç‡πâ‡∏≤‡∏°‚Äù echo ‡∏Ç‡∏≠‡∏á `metadata: "order_audit"` ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≤‡∏° `ai_generated`/`follow_up_auto` ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß

### 9.3 Cooldown / Dedupe

MVP ‡πÉ‡∏ä‡πâ:
- `waitForMainAiSeconds` ‡πÄ‡∏°‡∏∑‡πà‡∏≠ `mainAiEnabled=true` (‡πÉ‡∏´‡πâ AI ‡∏´‡∏•‡∏±‡∏Å‡∏™‡πà‡∏á‡∏Å‡πà‡∏≠‡∏ô)
- `pending.dueAt + triggerMessageId` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥ ‚Äú‡∏£‡∏≠/‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å/‡∏ï‡∏£‡∏ß‡∏à‡πÉ‡∏´‡∏°‡πà‚Äù ‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠ 3.1.1
- `lastProcessedMessageId` ‡πÄ‡∏û‡∏∑‡πà‡∏≠ trace/monitor ‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á session

## 10) Data Model (MongoDB)

### 10.1 `follow_up_page_settings` (‡πÄ‡∏û‡∏¥‡πà‡∏° `orderAudit`)

> ‡πÄ‡∏Å‡πá‡∏ö per-page config ‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°

```javascript
{
  platform: "line" | "facebook",
  botId: String | null,

  // ...
  orderAudit: {
    enabled: Boolean,
    waitForMainAiSeconds: 60,                  // debounce window ‡πÄ‡∏°‡∏∑‡πà‡∏≠ main AI ‡πÄ‡∏õ‡∏¥‡∏î (‡∏Ç‡πâ‡∏≠ 3.1.1)
  }
}
```

> **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (MVP):** ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ö‡∏ö push (‡∏™‡πà‡∏á‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤) ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° template ‡πÅ‡∏ö‡∏ö fixed ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î

### 10.2 `order_audit_sessions` (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°)

> ‡πÄ‡∏Å‡πá‡∏ö state ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏ñ‡∏≤‡∏°‡∏ã‡πâ‡∏≥/‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∞‡πÑ‡∏£

```javascript
{
  pageKey: String,
  platform: "line" | "facebook",
  botId: String | null,
  userId: String,

  status: "collecting" | "complete",
  draft: Object,
  missingFields: Array,
  lastAskedFields: Array,

  pending: {
    kind: "ask_missing" | "summary",
    messageText: String,
    dueAt: Date,
    triggeredAt: Date,
    triggerMessageId: String | null
  },

  lastProcessedAt: Date,
  lastProcessedMessageId: String | null,
  lastPushedAt: Date | null,

  createdAt: Date,
  updatedAt: Date,
  expireAt: Date // TTL
}
```

## 11) Message Templates (‡∏£‡∏ß‡∏°‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)

### 11.1 Placeholder

- `{items}` ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏•‡∏∞ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
- `{total}` ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°
- `{shippingLine}` ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á/‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ
- `{customerName}`, `{shippingAddress}`, `{subDistrict}`, `{district}`, `{province}`, `{postalCode}`, `{phone}`
- `{eta}` ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
- `{missingFields}` ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏Ç‡∏≤‡∏î

### 11.2 Template A (Emoji / ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)

```text
‚úÖ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏∞ ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

{items}
‚≠êÔ∏è‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° {total} ‡∏ö‡∏≤‡∏ó{shippingLine}

‡∏ä‡∏∑‡πà‡∏≠: {customerName}
‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: {shippingAddress} ‡∏ï.{subDistrict} ‡∏≠.{district}
‡∏à.{province} {postalCode}
‡πÇ‡∏ó‡∏£: {phone}

üöö‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô {eta} ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏∞
‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏‡∏à‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏£‡∏≤‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡∏Å‡∏Ñ‡πà‡∏∞‚úÖ
```

### 11.3 Template B (‡∏™‡∏±‡πâ‡∏ô/‡πÄ‡∏£‡∏µ‡∏¢‡∏ö)

```text
‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
{items}
‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: {total} ‡∏ö‡∏≤‡∏ó{shippingLine}

‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á
‡∏ä‡∏∑‡πà‡∏≠: {customerName}
‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: {shippingAddress} ‡∏ï.{subDistrict} ‡∏≠.{district} {postalCode}
‡πÇ‡∏ó‡∏£: {phone}
```

### 11.4 Template C (‡∏™‡∏∏‡∏†‡∏≤‡∏û/‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£)

```text
‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡∏Ç‡∏≠‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

{items}
‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° {total} ‡∏ö‡∏≤‡∏ó{shippingLine}

‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
- ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö: {customerName}
- ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: {shippingAddress} ‡∏ï.{subDistrict} ‡∏≠.{district} ‡∏à.{province} {postalCode}
- ‡πÇ‡∏ó‡∏£: {phone}

‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì {eta} ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£
```

### 11.5 ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≤‡∏î (Ask All Missing)

```text
‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡πÅ‡∏à‡πâ‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏∞
1) ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö
2) ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà/‡∏´‡∏°‡∏π‡πà/‡∏ã‡∏≠‡∏¢/‡∏ñ‡∏ô‡∏ô)
3) ‡∏ï‡∏≥‡∏ö‡∏•/‡πÅ‡∏Ç‡∏ß‡∏á + ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠/‡πÄ‡∏Ç‡∏ï + ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå 5 ‡∏´‡∏•‡∏±‡∏Å
4) ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ 10 ‡∏´‡∏•‡∏±‡∏Å
```

## 12) Acceptance Criteria & Test Cases (MVP)

### 12.1 Acceptance Criteria

1) ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ‡∏£‡∏≤‡∏¢‡πÄ‡∏û‡∏à/‡∏£‡∏≤‡∏¢‡∏ö‡∏≠‡∏ó‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ Admin  
2) ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ö‡∏ö `push_customer` (‡∏™‡πà‡∏á‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ö‡∏ö push)  
3) Audit ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 2 ‡πÅ‡∏ö‡∏ö: ‡∏™‡∏£‡∏∏‡∏õ ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≤‡∏î  
4) **‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö order draft ‡∏´‡∏£‡∏∑‡∏≠ `items` ‡∏ß‡πà‡∏≤‡∏á**  
5) Validate:
   - ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏´‡∏•‡∏±‡∏á normalize ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô 10 ‡∏´‡∏•‡∏±‡∏Å (`^0\\d{9}$`)
   - ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå 5 ‡∏´‡∏•‡∏±‡∏Å (`^\\d{5}$`)
6) ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ AI ‡∏´‡∏•‡∏±‡∏Å‡∏õ‡∏¥‡∏î/‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏≠‡∏ö‡πÄ‡∏≠‡∏á (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏•‡∏∞ Facebook inbox)  
7) ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏î loop ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á Audit ‡πÄ‡∏≠‡∏á (`source/metadata="order_audit"` + ignore)  
8) ‡∏ñ‡πâ‡∏≤ `mainAiEnabled=true` ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏á‡∏ï‡∏≤‡∏° `waitForMainAiSeconds` ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á (‡∏ó‡∏±‡πâ‡∏á‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô)  
9) ‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å pending ‡πÄ‡∏î‡∏¥‡∏° ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°)

### 12.2 Test Cases (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô LINE/FB)

1) **‡∏ñ‡∏≤‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤/‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πä‡∏≠‡∏Å (‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠)**  
   - ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: `‡∏ß‡∏¥‡∏Å‡∏ú‡∏°‡∏™‡∏≤‡∏¢‡∏ù‡∏≠ ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà‡∏Ñ‡∏∞`  
   - Expected: extractor ‡∏Ñ‡∏∑‡∏ô `hasDraft=false` (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ `items=[]`) ‡πÅ‡∏•‡∏∞ Audit **‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°**

2) ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô  
3) ‡∏Ç‡∏≤‡∏î‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏≤‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå 10 ‡∏´‡∏•‡∏±‡∏Å  
4) ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö 10 ‡∏´‡∏•‡∏±‡∏Å ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡πÉ‡∏´‡∏°‡πà  
5) ‡πÄ‡∏ö‡∏≠‡∏£‡πå `+66` ‚Üí normalize ‡πÅ‡∏•‡πâ‡∏ß‡∏ú‡πà‡∏≤‡∏ô (`099...`)  
6) ‡∏Ç‡∏≤‡∏î‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏≤‡∏° 5 ‡∏´‡∏•‡∏±‡∏Å  
7) ‡∏Ç‡∏≤‡∏î‡∏ï‡∏≥‡∏ö‡∏•/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö  
8) ‡∏õ‡∏¥‡∏î AI ‡∏´‡∏•‡∏±‡∏Å ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡∏¥‡∏î Audit ‚Üí ‡∏¢‡∏±‡∏á‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≤‡∏î/‡∏™‡∏£‡∏∏‡∏õ‡πÑ‡∏î‡πâ  
9) ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å Facebook inbox (`source: admin_page`) ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö ‚Üí Audit ‡∏ï‡πâ‡∏≠‡∏á track ‡∏ï‡πà‡∏≠‡∏à‡∏ô ‚Äú‡∏Ñ‡∏£‡∏ö‚Äù
10) ‡πÄ‡∏õ‡∏¥‡∏î AI ‡∏´‡∏•‡∏±‡∏Å + ‡∏ï‡∏±‡πâ‡∏á `waitForMainAiSeconds=60` ‚Üí Audit ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á  
   - Expected: ‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‚Üí ‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏£‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
11) ‡πÄ‡∏õ‡∏¥‡∏î AI ‡∏´‡∏•‡∏±‡∏Å + ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏≠ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏° ‚Üí Audit ‡∏ï‡πâ‡∏≠‡∏á ‚Äú‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°‚Äù ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö
12) ‡πÄ‡∏õ‡∏¥‡∏î AI ‡∏´‡∏•‡∏±‡∏Å + ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‚Äú‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‚Äù ‡∏Å‡πá‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ `waitForMainAiSeconds` ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô

## 13) UI/Settings (‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á)

‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô modal ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô `views/admin-orders.ejs` (Order AI Settings):

- Toggle `orderAudit.enabled`
- Input `orderAudit.waitForMainAiSeconds`

## 14) Checklist ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ (‡∏™‡∏£‡∏∏‡∏õ)

- [x] ‡πÄ‡∏û‡∏¥‡πà‡∏° schema/field `orderAudit` ‡πÉ‡∏ô `follow_up_page_settings`
- [x] ‡πÄ‡∏û‡∏¥‡πà‡∏° collection `order_audit_sessions` + TTL index
- [x] Implement `OrderDraftExtractor` (AI prompt ‡πÅ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å order extraction ‡πÄ‡∏î‡∏¥‡∏°)
- [x] Implement `OrderAuditRunner` (pending + loop prevention)
- [x] ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ö‡∏ö push (LINE/Facebook) ‡∏û‡∏£‡πâ‡∏≠‡∏° tag `metadata/source=order_audit`
- [x] ‡πÄ‡∏û‡∏¥‡πà‡∏° UI/endpoint ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏£‡∏≤‡∏¢‡πÄ‡∏û‡∏à + ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ wait seconds
