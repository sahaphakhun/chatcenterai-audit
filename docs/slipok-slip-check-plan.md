# ‡πÅ‡∏ú‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤: ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Å‡∏™‡∏•‡∏¥‡∏õ SlipOK ‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (LINE)

> **Last updated:** 2025-12-17  
> **Status:** Draft  
> **Priority:** High  
> **Related:** `docs/notification-channels-development-plan.md`, `SlipOK API Guide.md`

## ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ô‡∏™‡πà‡∏á **‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û** ‡πÄ‡∏Ç‡πâ‡∏≤ ‚Äú‡∏Å‡∏•‡∏∏‡πà‡∏°/‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‚Äù (LINE group/room) ‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏ß‡πâ ‚Üí ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏•‡∏¥‡∏õ‡∏ú‡πà‡∏≤‡∏ô **SlipOK** ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
- ‡∏ñ‡πâ‡∏≤‡∏™‡∏•‡∏¥‡∏õ ‚Äú‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‚Äù ‚Üí ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢: **‡∏™‡∏•‡∏¥‡∏õ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á / ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô / ‡∏Ñ‡∏ô‡πÇ‡∏≠‡∏ô / ‡∏Ñ‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô / ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏™‡∏•‡∏¥‡∏õ**
- ‡∏ñ‡πâ‡∏≤‡∏™‡∏•‡∏¥‡∏õ ‚Äú‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‚Äù ‡∏´‡∏£‡∏∑‡∏≠ ‚Äú‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏™‡∏•‡∏¥‡∏õ‚Äù ‚Üí ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏™‡∏±‡πâ‡∏ô ‡πÜ
- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô **‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°** (text) ‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° ‚Üí **‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö**
- ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö **‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå** (‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)

## ‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏à‡∏∏‡∏î‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á)
- LINE Webhook: `POST /webhook/line/:botId` ‚Üí loop `events` ‚Üí `handleLineEvent(event, queueOptions)` (`index.js`)
- ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô group/room event ‡πÉ‡∏ô `handleLineEvent()` ‡∏ó‡∏≥‡πÅ‡∏Ñ‡πà `captureLineGroupEvent()` ‡πÅ‡∏•‡πâ‡∏ß `return;` (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°)
- ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå: `notification_channels` + `services/notificationService.js` (‡∏™‡πà‡∏á `pushMessage` ‡πÑ‡∏õ‡∏¢‡∏±‡∏á groupId)
- ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:  
  - UI modal: `views/partials/modals/notification-channel-modal.ejs`  
  - Logic: `public/js/notification-channels.js`  
  - Backend CRUD: `/admin/api/notification-channels*` ‡πÉ‡∏ô `index.js`

## ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏á‡∏≤‡∏ô (MVP)
1. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äú‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏•‡∏¥‡∏õ SlipOK ‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ‚Äù ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Notification Channel (Order Notifications)
2. ‡πÄ‡∏°‡∏∑‡πà‡∏≠ LINE bot ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö event ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó `message:image` ‡∏à‡∏≤‡∏Å group/room ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏µ‡πâ:
   - ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å LINE (`lineClient.getMessageContent(message.id)`)
   - ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡πÑ‡∏õ‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡∏µ‡πà SlipOK (Check Slip API)
   - ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° (‡πÉ‡∏ä‡πâ `replyMessage` ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å)
3. ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠ event ‡πÄ‡∏õ‡πá‡∏ô `message:text` ‡∏´‡∏£‡∏∑‡∏≠ message type ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°

## ‡∏ô‡∏≠‡∏Å‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï (‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ Phase 2+)
- Flex Message / ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
- Auto-match ‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (‡πÄ‡∏ä‡πà‡∏ô‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏¢‡∏≠‡∏î‡∏Å‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
- Dashboard ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏•‡∏¥‡∏õ/‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤/‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏•‡∏¥‡∏õ‡∏ö‡∏ô Facebook/‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô

## SlipOK API ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ (‡∏≠‡∏¥‡∏á `SlipOK API Guide.md`)
### Check Slip
- **Method:** `POST`
- **URL:** `https://api.slipok.com/api/line/apikey/<YOUR_BRANCH_ID>`
- **Header:** `x-authorization: <YOUR_API_KEY>`
- **Body:** ‡∏™‡πà‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á: `data` (QR string) / `files` (‡∏£‡∏π‡∏õ) / `url` (‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ)
- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏ì‡∏µ LINE group/room ‡∏à‡∏∞‡πÉ‡∏ä‡πâ **‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ** (`files`) ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å
- ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ **SlipOK API URL + API Key** ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ env)

### ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö
- Success: `HTTP 200` ‚Üí `{ success: true, data: { success: true, ... } }`
- Fail: ‡∏°‡∏±‡∏Å‡πÄ‡∏õ‡πá‡∏ô `HTTP 400/401` ‚Üí `{ code, message, data? }` (‡∏ö‡∏≤‡∏á‡∏Å‡∏£‡∏ì‡∏µ‡∏°‡∏µ `data` ‡πÅ‡∏ô‡∏ö‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤)
- ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠‡∏ö‡πà‡∏≠‡∏¢ (‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏≤‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£): `1006, 1007, 1008, 1010, 1012, 1013, 1014, 1002, 1004`

## Data Model (MongoDB)
> ‡∏¢‡∏∂‡∏î pattern ‡πÄ‡∏î‡∏¥‡∏°: ‡πÄ‡∏Å‡πá‡∏ö config ‡πÉ‡∏ô `notification_channels.settings` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ ‚Äú‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°‚Äù ‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å

### `notification_channels.settings` (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå)
‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:
```js
{
  // ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏° (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå)
  template: "simple",
  includeCustomer: true,
  includeItemsCount: true,
  includeItemsDetail: true,
  includeAddress: true,
  includePhone: true,
  includePaymentMethod: true,
  includeTotalAmount: true,
  includeOrderLink: false,

  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà (SlipOK)
  slipOkEnabled: false,     // ‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏•‡∏¥‡∏õ‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  slipOkApiUrl: "",         // ‡πÄ‡∏ä‡πà‡∏ô https://api.slipok.com/api/line/apikey/57824
  slipOkApiKey: ""          // ‡πÄ‡∏ä‡πà‡∏ô SLIPOKWU4P56T
}
```

> ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏à‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï `normalizeNotificationChannelSettings()` (`index.js`) ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà + default

## Config
- ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ env ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SlipOK
- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ `SlipOK API URL` ‡πÅ‡∏•‡∏∞ `SlipOK API Key` ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô ‡∏ï‡πà‡∏≠ ‚Äú‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‚Äù ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏•‡∏¥‡∏õ

## Flow ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (Runtime)
1. LINE ‡∏™‡πà‡∏á webhook event ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ó‡∏µ‡πà `POST /webhook/line/:botId`
2. `handleLineEvent()` ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô group/room:
   - ‡∏¢‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `captureLineGroupEvent()` ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ UI ‡πÄ‡∏´‡πá‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°)
   - ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á `return` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÅ‡∏ä‡∏ó‡∏Å‡∏•‡∏∏‡πà‡∏° ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô `message:image` ‡∏à‡∏∞ trigger ‡∏á‡∏≤‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏•‡∏¥‡∏õ‡πÅ‡∏ö‡∏ö async ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
3. ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏•‡∏¥‡∏õ
   - event ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô `message` ‡πÅ‡∏•‡∏∞ `message.type === "image"`
   - ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤ Notification Channel ‡∏ó‡∏µ‡πà `isActive:true`, `type:"line_group"`, `senderBotId == botId`, `groupId == (event.source.groupId/roomId)` ‡πÅ‡∏•‡∏∞ `settings.slipOkEnabled:true`
   - ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ `settings.slipOkApiUrl` + `settings.slipOkApiKey`
   - ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç ‚Üí ignore (‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö)
4. ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å LINE ‡πÅ‡∏•‡πâ‡∏ß call SlipOK
   - `lineClient.getMessageContent(message.id)` ‚Üí Buffer
   - `POST` ‡πÑ‡∏õ SlipOK ‡∏î‡πâ‡∏ß‡∏¢ `multipart/form-data` (`form-data` + `axios`) ‡πÇ‡∏î‡∏¢‡πÉ‡∏™‡πà field:
     - `files`: <image buffer>
5. ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
   - ‡πÉ‡∏ä‡πâ `lineClient.replyMessage(replyToken, { type:"text", text })` ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å (‡∏•‡∏î push quota)
   - ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ `replyToken` (‡∏Å‡∏£‡∏ì‡∏µ edge) ‡∏Ñ‡πà‡∏≠‡∏¢ fallback ‡πÄ‡∏õ‡πá‡∏ô `pushMessage(groupId, ...)`

## ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)
### ‡∏Å‡∏£‡∏ì‡∏µ‡∏™‡∏•‡∏¥‡∏õ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
```
‚úÖ ‡∏™‡∏•‡∏¥‡∏õ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
üí∞ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô: ‡∏ø1,000
üë§ ‡∏ú‡∏π‡πâ‡πÇ‡∏≠‡∏ô: ‡∏ô‡∏≤‡∏¢ A
üè¶ ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö: ‡∏£‡πâ‡∏≤‡∏ô B
üïí ‡πÄ‡∏ß‡∏•‡∏≤: 01/04/2020 10:15:07
```

### ‡∏Å‡∏£‡∏ì‡∏µ‡∏™‡∏•‡∏¥‡∏õ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á/‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏™‡∏•‡∏¥‡∏õ
```
‚ùå ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏•‡∏¥‡∏õ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô (1007)
‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏°‡∏µ QR code
```

> ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏° ‚Äú‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÇ‡∏≠‡∏ô/‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‚Äù ‡∏à‡∏≤‡∏Å `sendingBank/receivingBank` (bank code) ‡πÑ‡∏î‡πâ‡πÉ‡∏ô Phase 2
> (MVP: ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà SlipOK ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö ‡∏ñ‡πâ‡∏≤ field ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á)

## Error Handling (‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á)
- `1006/1007/1008`: ‡∏ï‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏•‡∏¥‡∏õ/‡∏ï‡∏£‡∏ß‡∏à‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏û‡∏£‡πâ‡∏≠‡∏° message ‡∏™‡∏±‡πâ‡∏ô ‡πÜ
- `1010`: ‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà SlipOK ‡πÅ‡∏à‡πâ‡∏á (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å API)
- `1012`: ‡∏ï‡∏≠‡∏ö‡∏ß‡πà‡∏≤ ‚Äú‡∏™‡∏•‡∏¥‡∏õ‡∏ã‡πâ‡∏≥‚Äù ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏™‡πà‡∏á (‡∏à‡∏≤‡∏Å `message`)
- `1013/1014`: ‡∏ï‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç (‡∏¢‡∏≠‡∏î‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á/‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á) ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•
- `1002/1003/1004`: ‡∏ï‡∏≠‡∏ö‡∏ß‡πà‡∏≤ ‚Äú‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏•‡∏¥‡∏õ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°/‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏≠‚Äù (‡∏û‡∏£‡πâ‡∏≠‡∏° log ‡∏ù‡∏±‡πà‡∏á server)
- ‡∏ï‡∏±‡πâ‡∏á `timeout` ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏ö error ‡∏Å‡∏£‡∏ì‡∏µ SlipOK ‡∏•‡πà‡∏°: ‡∏ï‡∏≠‡∏ö ‚Äú‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏•‡∏¥‡∏õ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‚Äù

## ‡πÅ‡∏ú‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô (‡∏™‡∏±‡πâ‡∏ô + ‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ)
### Phase 1 (MVP) ‚Äî ‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏•‡∏¥‡∏õ‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏ô UI (toggle + SlipOK API URL + API Key) ‡∏ï‡πà‡∏≠‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° `services/slipOkService.js` (call SlipOK + normalize response/error)
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° logic ‡πÉ‡∏ô `handleLineEvent()` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö group `message:image` ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î `settings.slipOkEnabled`
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏ô UI modal + ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏õ backend (`views/partials/modals/notification-channel-modal.ejs`, `public/js/notification-channels.js`)
- [ ] ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï `normalizeNotificationChannelSettings()` + mapping ‡πÉ‡∏ô `mapNotificationChannelDoc()` ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö UI ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

**Acceptance (‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏°‡∏∑‡∏≠)**
- ‡πÄ‡∏õ‡∏¥‡∏î ‚Äú‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏•‡∏¥‡∏õ SlipOK‚Äù ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ä‡∏µ‡πâ‡πÑ‡∏õ group/room ‡∏´‡∏ô‡∏∂‡πà‡∏á
- ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° ‚Üí ‡∏ö‡∏≠‡∏ó‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö
- ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏™‡∏•‡∏¥‡∏õ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚Üí ‡∏ö‡∏≠‡∏ó‡∏ï‡∏≠‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á + amount/sender/receiver/time
- ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ/‡∏™‡∏•‡∏¥‡∏õ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚Üí ‡∏ö‡∏≠‡∏ó‡∏ï‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•

### Phase 2 ‚Äî UX/‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥
- [ ] ‡πÅ‡∏¢‡∏Å template ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö + ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÉ‡∏´‡πâ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
- [ ] (optional) ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å log ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏•‡∏¥‡∏õ‡∏•‡∏á DB ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
- [ ] (optional) ‡∏õ‡∏∏‡πà‡∏° ‚Äú‡πÄ‡∏ä‡πá‡∏Ñ‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤ SlipOK‚Äù (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å quota endpoint) ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô

## ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á/‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á
- ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö: SlipOK call ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ webhook ‡∏ä‡πâ‡∏≤ ‚Üí ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà block ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏ä‡πà‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô async ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢ reply/push)
- Privacy: ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏π‡∏õ‡∏™‡∏•‡∏¥‡∏õ‡∏•‡∏á DB ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
- Secrets: ‡∏´‡πâ‡∏≤‡∏° log API key ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤ config ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
- Rate/Quota: ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ô spam (‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï) ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°

## Open Questions (‡∏Ç‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏¥‡∏£‡πå‡∏°)
‡πÑ‡∏°‡πà‡∏°‡∏µ (‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏¥‡∏£‡πå‡∏°‡πÅ‡∏•‡πâ‡∏ß: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API ‡πÉ‡∏ô UI, ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ config log/group-only, ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ó‡πà‡∏≤‡∏ó‡∏µ‡πà API ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö)
