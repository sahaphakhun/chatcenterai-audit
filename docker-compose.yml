version: '3.8'

services:
  chatcenter-ai:
    image: xianta456/chatcenter-ai:latest
    container_name: chatcenter-ai
    ports:
      - "3000:3000"
    environment:
      # Server Configuration
      - NODE_ENV=production
      - PORT=3000
      
      # Database
      - MONGODB_URI=${MONGODB_URI}
      
      # Session
      - SESSION_SECRET=${SESSION_SECRET}
      
      # AI API Keys
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      
      # LINE Bot Configuration
      - LINE_CHANNEL_SECRET=${LINE_CHANNEL_SECRET}
      - LINE_CHANNEL_ACCESS_TOKEN=${LINE_CHANNEL_ACCESS_TOKEN}
      
      # Facebook Bot Configuration
      - FACEBOOK_VERIFY_TOKEN=${FACEBOOK_VERIFY_TOKEN}
      - FACEBOOK_PAGE_ACCESS_TOKEN=${FACEBOOK_PAGE_ACCESS_TOKEN}
    
    restart: unless-stopped
    
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:3000/health', (res) => { process.exit(res.statusCode === 200 ? 0 : 1) })"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s
    
    # Optional: Mount volume for logs
    # volumes:
    #   - ./logs:/app/logs
    
    networks:
      - chatcenter-network

networks:
  chatcenter-network:
    driver: bridge

# Optional: Add MongoDB service
# services:
#   mongodb:
#     image: mongo:7
#     container_name: chatcenter-mongodb
#     ports:
#       - "27017:27017"
#     environment:
#       - MONGO_INITDB_ROOT_USERNAME=admin
#       - MONGO_INITDB_ROOT_PASSWORD=password
#     volumes:
#       - mongodb_data:/data/db
#     networks:
#       - chatcenter-network
#
# volumes:
#   mongodb_data:
